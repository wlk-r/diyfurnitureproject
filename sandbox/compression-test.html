<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLB Compression Comparison</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            background: #f7f5ee;
            padding: 20px;
            line-height: 1.6;
        }
        h1 { font-size: 14px; margin-bottom: 8px; }
        .subtitle { color: #666; margin-bottom: 20px; }
        h2 { font-size: 12px; margin: 24px 0 12px; text-transform: uppercase; letter-spacing: 0.05em; }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .model-card {
            background: white;
            border: 1px solid #d8d2c6;
            padding: 16px;
        }

        .model-card h3 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .model-card.placeholder {
            background: #f9f9f9;
        }

        .model-card.placeholder model-viewer {
            display: none;
        }

        .placeholder-box {
            width: 100%;
            height: 300px;
            background: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #999;
            padding: 20px;
        }

        model-viewer {
            width: 100%;
            height: 300px;
            background: #fafafa;
        }

        .stats {
            margin-top: 12px;
            padding: 10px;
            background: #f5f5f5;
            font-size: 10px;
        }

        .stats .size { font-size: 14px; font-weight: 500; }
        .stats .reduction { color: #2a9d2a; font-weight: 500; }
        .stats .increase { color: #d32f2f; }

        .drop-zone {
            border: 2px dashed #ccc;
            padding: 40px;
            text-align: center;
            margin-bottom: 24px;
            background: white;
            transition: all 0.2s;
        }

        .drop-zone.dragover {
            border-color: #1f1f1f;
            background: #f0f0f0;
        }

        .drop-zone input {
            display: none;
        }

        .drop-zone label {
            cursor: pointer;
            text-decoration: underline;
        }

        .instructions {
            background: white;
            border: 1px solid #d8d2c6;
            padding: 20px;
            margin-bottom: 24px;
        }

        .instructions pre {
            background: #1f1f1f;
            color: #f0f0f0;
            padding: 16px;
            margin: 12px 0;
            overflow-x: auto;
            font-size: 11px;
            line-height: 1.5;
        }

        .instructions code {
            background: #f0f0f0;
            padding: 2px 6px;
        }

        .instructions ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .instructions li {
            margin-bottom: 6px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 11px;
        }

        th, td {
            border: 1px solid #d8d2c6;
            padding: 8px 12px;
            text-align: left;
        }

        th {
            background: #f5f5f5;
            font-weight: 500;
        }

        .file-list {
            margin-top: 16px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: #f9f9f9;
            margin-bottom: 4px;
        }

        .clear-btn {
            background: #1f1f1f;
            color: white;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
            margin-top: 12px;
        }

        .clear-btn:hover {
            background: #333;
        }
    </style>
</head>
<body>
    <h1>GLB Compression Comparison</h1>
    <p class="subtitle">Compare file sizes and visual quality across different compression methods</p>

    <!-- Drag and Drop Zone -->
    <div class="drop-zone" id="dropZone">
        <p>Drag & drop GLB files here to compare</p>
        <p>or <label for="fileInput">browse files</label></p>
        <input type="file" id="fileInput" accept=".glb,.gltf" multiple>
        <div class="file-list" id="fileList"></div>
    </div>

    <!-- Comparison Grid -->
    <div class="comparison-grid" id="comparisonGrid">
        <!-- Original Model -->
        <div class="model-card">
            <h3>Original (Uncompressed)</h3>
            <model-viewer
                id="viewer-original"
                src="../model1.glb"
                alt="Original model"
                camera-controls
                auto-rotate
                shadow-intensity="1"
                exposure="1">
            </model-viewer>
            <div class="stats" id="stats-original">Loading...</div>
        </div>

        <!-- Draco Compressed -->
        <div class="model-card placeholder" id="card-draco">
            <h3>Draco Compressed</h3>
            <model-viewer
                id="viewer-draco"
                src=""
                alt="Draco compressed"
                camera-controls
                auto-rotate
                shadow-intensity="1"
                exposure="1">
            </model-viewer>
            <div class="placeholder-box">
                Create with:<br>
                <code>gltf-transform optimize model.glb model-draco.glb --compress draco</code>
            </div>
            <div class="stats" id="stats-draco">
                Place <code>model1-draco.glb</code> in sandbox folder
            </div>
        </div>

        <!-- Meshopt Compressed -->
        <div class="model-card placeholder" id="card-meshopt">
            <h3>Meshopt Compressed</h3>
            <model-viewer
                id="viewer-meshopt"
                src=""
                alt="Meshopt compressed"
                camera-controls
                auto-rotate
                shadow-intensity="1"
                exposure="1">
            </model-viewer>
            <div class="placeholder-box">
                Create with:<br>
                <code>gltf-transform optimize model.glb model-meshopt.glb --compress meshopt</code>
            </div>
            <div class="stats" id="stats-meshopt">
                Place <code>model1-meshopt.glb</code> in sandbox folder
            </div>
        </div>

        <!-- Quantized -->
        <div class="model-card placeholder" id="card-quantized">
            <h3>Quantized (Reduced Precision)</h3>
            <model-viewer
                id="viewer-quantized"
                src=""
                alt="Quantized"
                camera-controls
                auto-rotate
                shadow-intensity="1"
                exposure="1">
            </model-viewer>
            <div class="placeholder-box">
                Create with:<br>
                <code>gltf-transform quantize model.glb model-quantized.glb</code>
            </div>
            <div class="stats" id="stats-quantized">
                Place <code>model1-quantized.glb</code> in sandbox folder
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="instructions">
        <h2>How to Create Compressed Versions</h2>

        <h3 style="margin-top: 16px;">Option 1: gltf-transform (Recommended)</h3>
        <p>Install and use the CLI tool:</p>
        <pre>npm install -g @gltf-transform/cli

# Draco compression (best size reduction)
gltf-transform optimize model1.glb model1-draco.glb --compress draco

# Meshopt compression (good balance)
gltf-transform optimize model1.glb model1-meshopt.glb --compress meshopt

# Quantize only (reduces precision)
gltf-transform quantize model1.glb model1-quantized.glb

# Full optimization pipeline
gltf-transform optimize model1.glb model1-optimized.glb \
  --compress draco \
  --texture-compress webp</pre>

        <h3 style="margin-top: 16px;">Option 2: Blender Export Settings</h3>
        <p>When exporting GLB from Blender:</p>
        <ul>
            <li>Enable <strong>Compression</strong> checkbox</li>
            <li>Set compression level (0-6, higher = smaller but slower)</li>
            <li>Enable <strong>Draco Mesh Compression</strong></li>
            <li>Adjust quantization bits (lower = smaller but less precise)</li>
        </ul>

        <h3 style="margin-top: 16px;">Option 3: gltfpack</h3>
        <pre>npm install -g gltfpack

# Aggressive compression
gltfpack -i model1.glb -o model1-packed.glb -cc</pre>

        <h2>Compression Comparison Table</h2>
        <table>
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Typical Reduction</th>
                    <th>Quality Loss</th>
                    <th>Browser Support</th>
                    <th>Best For</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Draco</td>
                    <td>80-95%</td>
                    <td>Minimal</td>
                    <td>Excellent</td>
                    <td>Maximum compression</td>
                </tr>
                <tr>
                    <td>Meshopt</td>
                    <td>50-70%</td>
                    <td>None</td>
                    <td>Excellent</td>
                    <td>Lossless compression</td>
                </tr>
                <tr>
                    <td>Quantize</td>
                    <td>30-50%</td>
                    <td>Slight</td>
                    <td>Excellent</td>
                    <td>Simple optimization</td>
                </tr>
                <tr>
                    <td>Texture WebP</td>
                    <td>60-80% (textures)</td>
                    <td>Minimal</td>
                    <td>Good</td>
                    <td>Textured models</td>
                </tr>
                <tr>
                    <td>KTX2/Basis</td>
                    <td>75-90% (textures)</td>
                    <td>Slight</td>
                    <td>Good</td>
                    <td>GPU-optimized textures</td>
                </tr>
            </tbody>
        </table>

        <h2>Recommended Workflow</h2>
        <ol style="margin-left: 20px; margin-top: 8px;">
            <li>Start with your original high-quality GLB</li>
            <li>Create Draco-compressed version</li>
            <li>Compare visually in this tool</li>
            <li>If quality is acceptable, use compressed version</li>
            <li>Target: &lt;2MB for fast loading, &lt;5MB acceptable</li>
        </ol>
    </div>

    <script>
        let originalSize = 0;

        // Check for compressed versions and load them
        async function checkAndLoadModel(filename, viewerId, cardId, statsId) {
            const viewer = document.getElementById(viewerId);
            const card = document.getElementById(cardId);
            const stats = document.getElementById(statsId);

            try {
                const response = await fetch(filename, { method: 'HEAD' });
                if (response.ok) {
                    // File exists, load it
                    viewer.src = filename;
                    card.classList.remove('placeholder');
                    card.querySelector('.placeholder-box')?.remove();

                    viewer.addEventListener('load', async () => {
                        const size = response.headers.get('content-length');
                        const sizeKB = size ? (parseInt(size) / 1024).toFixed(1) : 'Unknown';
                        const sizeMB = size ? (parseInt(size) / 1024 / 1024).toFixed(2) : 'Unknown';
                        const reduction = originalSize > 0 ? ((1 - parseInt(size) / originalSize) * 100).toFixed(1) : 0;

                        stats.innerHTML = `
                            <div class="size">${sizeKB} KB (${sizeMB} MB)</div>
                            ${reduction > 0 ? `<div class="reduction">↓ ${reduction}% smaller</div>` : ''}
                        `;
                    });
                }
            } catch (e) {
                // File doesn't exist, keep placeholder
            }
        }

        // Load original and get its size
        async function loadOriginal() {
            const viewer = document.getElementById('viewer-original');
            const stats = document.getElementById('stats-original');

            viewer.addEventListener('load', async () => {
                try {
                    const response = await fetch(viewer.src, { method: 'HEAD' });
                    const size = response.headers.get('content-length');
                    originalSize = parseInt(size) || 0;
                    const sizeKB = size ? (parseInt(size) / 1024).toFixed(1) : 'Unknown';
                    const sizeMB = size ? (parseInt(size) / 1024 / 1024).toFixed(2) : 'Unknown';

                    stats.innerHTML = `
                        <div class="size">${sizeKB} KB (${sizeMB} MB)</div>
                        <div>Baseline for comparison</div>
                    `;

                    // Now check for compressed versions
                    checkAndLoadModel('model1-draco.glb', 'viewer-draco', 'card-draco', 'stats-draco');
                    checkAndLoadModel('model1-meshopt.glb', 'viewer-meshopt', 'card-meshopt', 'stats-meshopt');
                    checkAndLoadModel('model1-quantized.glb', 'viewer-quantized', 'card-quantized', 'stats-quantized');
                } catch (e) {
                    stats.innerHTML = 'Could not load file info';
                }
            });
        }

        loadOriginal();

        // Drag and drop handling
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const grid = document.getElementById('comparisonGrid');

        let droppedFiles = [];

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            for (const file of files) {
                if (file.name.endsWith('.glb') || file.name.endsWith('.gltf')) {
                    addFileToComparison(file);
                }
            }
        }

        function addFileToComparison(file) {
            const url = URL.createObjectURL(file);
            const id = `dropped-${Date.now()}`;
            const sizeKB = (file.size / 1024).toFixed(1);
            const sizeMB = (file.size / 1024 / 1024).toFixed(2);
            const reduction = originalSize > 0 ? ((1 - file.size / originalSize) * 100).toFixed(1) : 0;

            // Add to file list
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <span>${file.name}</span>
                <span>${sizeKB} KB ${reduction > 0 ? `(↓${reduction}%)` : ''}</span>
            `;
            fileList.appendChild(fileItem);

            // Add model card
            const card = document.createElement('div');
            card.className = 'model-card';
            card.id = `card-${id}`;
            card.innerHTML = `
                <h3>${file.name}</h3>
                <model-viewer
                    id="viewer-${id}"
                    src="${url}"
                    alt="${file.name}"
                    camera-controls
                    auto-rotate
                    shadow-intensity="1"
                    exposure="1">
                </model-viewer>
                <div class="stats">
                    <div class="size">${sizeKB} KB (${sizeMB} MB)</div>
                    ${reduction > 0 ? `<div class="reduction">↓ ${reduction}% smaller than original</div>` : ''}
                    ${reduction < 0 ? `<div class="increase">↑ ${Math.abs(reduction)}% larger than original</div>` : ''}
                </div>
            `;
            grid.appendChild(card);

            droppedFiles.push({ id, url });
        }

        // Add clear button if files are dropped
        function addClearButton() {
            if (!document.getElementById('clearBtn')) {
                const btn = document.createElement('button');
                btn.id = 'clearBtn';
                btn.className = 'clear-btn';
                btn.textContent = 'Clear Dropped Files';
                btn.onclick = clearDroppedFiles;
                dropZone.appendChild(btn);
            }
        }

        function clearDroppedFiles() {
            droppedFiles.forEach(f => {
                URL.revokeObjectURL(f.url);
                document.getElementById(`card-${f.id}`)?.remove();
            });
            droppedFiles = [];
            fileList.innerHTML = '';
            document.getElementById('clearBtn')?.remove();
        }
    </script>
</body>
</html>
